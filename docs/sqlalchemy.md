# 📘 프로젝트 기술 가이드: 데이터베이스 연결 도구 (SQLAlchemy)

## 1. SQLAlchemy가 뭔가요? (우리 프로젝트의 통역사)

우리는 **파이썬(Python)** 이라는 언어로 업무를 처리하지만, 우리의 데이터가 저장될 데이터베이스는 **SQL**이라는 전혀 다른 언어를 사용합니다. 서로 말이 통하지 않기 때문에 중간에서 통역해 줄 사람이 필요합니다.

**SQLAlchemy(에스큐엘 알케미)** 가 바로 그 **'통역사'** 입니다.

* 우리가 파이썬으로 명령을 내리면, 데이터베이스가 알아들을 수 있게 SQL로 번역해서 전달합니다.
* 복잡한 SQL 문법을 몰라도 파이썬 코드만으로 데이터를 저장하거나 가져올 수 있게 도와줍니다.

---

## 2. 우리 프로젝트에서는 어떻게 사용되나요?

이 프로젝트에서 SQLAlchemy는 크게 **3단계**로 움직입니다.

### 1단계: 연결 준비 (전화기 개통)

> **관련 파일:** `src/core/db.py`

가장 먼저 하는 일은 데이터베이스와 통화할 수 있는 **'전화기(Engine)'** 를 만드는 일입니다.

* **`DatabaseConfig`**: `.env` 파일(비밀 창고)에서 주소, 아이디, 비밀번호를 몰래 꺼내옵니다.
* **`get_db_engine()`**: 꺼내온 정보를 입력해서 `engine`이라는 도구를 만듭니다. 이 `engine`이 있어야만 데이터베이스에 접속할 수 있습니다.
* *코드 속 디테일:* `pool_size=5`라는 설정이 있는데, 이는 전화기 5대를 미리 연결해두고 돌려가며 쓰겠다는 뜻입니다. (속도를 빠르게 하기 위함)



### 2단계: 데이터 이사 (CSV → DB)

> **관련 파일:** `src/data_pipeline/load_data.py` - `load_csv_to_db` 함수

데이터 분석에 필요한 엑셀 파일(CSV)들을 데이터베이스로 옮기는 과정입니다.

* **`df.to_sql(..., con=engine)`**: 판다스(Pandas)라는 데이터 분석 도구가 데이터를 읽지만, 실제로 데이터베이스에 집어넣을 때는 아까 만든 **`engine`의 도움을 받아 전송**합니다.
* 즉, 판다스가 짐을 쌌다면, SQLAlchemy(Engine)가 트럭을 운전해서 DB로 배달하는 역할입니다.

### 3단계: 정리 정돈 (이름표 붙이기)

> **관련 파일:** `src/data_pipeline/load_data.py` - `add_primary_key`, `add_foreign_key` 함수

데이터가 들어가기만 하고 정리가 안 되어 있으면 엉망이 됩니다. SQLAlchemy를 이용해 직접 명령을 내려 정리를 합니다.

* **`engine.connect()`**: 이때 실제로 통화 버튼을 눌러 데이터베이스에 접속합니다.
* **`conn.execute(...)`**: "이 데이터가 기준이야(Primary Key)", "이 데이터는 저쪽 표를 참조해(Foreign Key)" 같은 정리 규칙을 데이터베이스에 직접 명령합니다.

---

## 3. 핵심 용어 요약 (이것만 알면 끝!)

| 용어 | 코드명 | 설명 | 비유 |
| --- | --- | --- | --- |
| **엔진** | `Engine` | 데이터베이스 연결 정보를 담고 있는 핵심 도구 | **스마트폰** (연락처 저장됨) |
| **연결** | `Connect` | 실제 데이터베이스 회선에 접속하는 행위 | **통화 버튼 누르기** |
| **실행** | `Execute` | 데이터베이스에 명령(SQL)을 전달하는 것 | **말하기 / 주문하기** |
| **커밋** | `Commit` | 작업한 내용을 최종 저장(확정)하는 것 | **"저장" 버튼 / 통화 종료** |

---

## 4. 자주 묻는 질문 (FAQ)

**Q. `Database connection failed` 에러가 떠요!**

> **A.** 높은 확률로 `.env` 파일의 설정이 잘못되었습니다. 아이디나 비밀번호, 혹은 데이터베이스 주소(IP)가 맞는지 확인해 주세요. (전화번호를 잘못 누른 상황입니다.)

**Q. `Foreign key constraints failed` 경고는 뭔가요?**

> **A.** 데이터 간의 관계가 맞지 않다는 뜻입니다. 예를 들어, '주문 내역'에는 고객 ID가 있는데, 정작 '고객 목록'에는 그 ID가 없는 경우입니다. 원본 데이터(CSV)를 확인해야 합니다.

**Q. 왜 `engine`을 계속 재사용하나요?**

> **A.** 데이터베이스에 접속하는 과정은 컴퓨터 입장에서 꽤 힘든 일입니다. 그래서 한 번 만들어둔 `engine`을 계속 재사용해서 성능을 높이는 것입니다.

---

### 🚀 요약

우리는 **SQLAlchemy** 덕분에 복잡한 SQL 쿼리문을 일일이 치지 않고, **파이썬 코드만으로 안전하고 편리하게** 대량의 데이터를 데이터베이스에 저장하고 관리하고 있습니다.